<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CapyOS v16 - Dynamic API</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="importmap">
      { "imports": { "@google/generative-ai": "https://esm.run/@google/generative-ai" } }
    </script>
    <style>
        body { background: #000; color: white; font-family: sans-serif; overflow: hidden; height: 100vh; margin: 0; }
        .glass { background: rgba(20, 20, 20, 0.95); backdrop-filter: blur(25px); border: 1px solid rgba(255,255,255,0.1); }
        .app-layer { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; transform: translateY(100%); transition: transform 0.4s cubic-bezier(0.1, 0.9, 0.2, 1); z-index: 100; }
        .app-active { transform: translateY(0%); }
        #api-setup { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 1000; display: none; align-items: center; justify-content: center; padding: 20px; }
    </style>
</head>
<body>

    <div id="api-setup" class="flex flex-col text-center">
        <h2 class="text-2xl font-black text-orange-500 mb-6">CAPYMAN ZEKASI Ä°Ã‡Ä°N API LAZIM KANKA</h2>
        <input id="api-input" type="password" placeholder="AIza... anahtarÄ±nÄ± buraya yapÄ±ÅŸtÄ±r" class="w-full bg-zinc-900 border border-zinc-700 p-4 rounded-2xl mb-4 text-white outline-none">
        <button onclick="saveApiKey()" class="w-full bg-orange-600 p-4 rounded-2xl font-bold active:scale-95 transition-transform">SÄ°STEME KAYDET</button>
        <p class="text-[10px] mt-4 opacity-40">Not: Anahtar sadece bu telefonda saklanÄ±r, GitHub'a gitmez.</p>
    </div>

    <div class="p-6 h-full flex flex-col items-center">
        <div class="w-full flex justify-between text-[10px] font-bold opacity-50 mb-10">
            <span id="top-clock">00:00</span>
            <span onclick="localStorage.removeItem('capy_api'); location.reload();" class="text-orange-500">API DEÄžÄ°ÅžTÄ°R</span>
        </div>

        <div id="capy-btn" class="mt-20 w-32 h-32 rounded-full glass flex items-center justify-center text-7xl cursor-pointer">ðŸ—¿</div>
        <p id="ai-status" class="mt-8 text-center text-orange-400 font-bold px-4 h-24 overflow-y-auto italic">
            "Kanka ðŸ—¿'ya bas, Gemini seni bekliyor."
        </p>

        <div class="grid grid-cols-2 gap-10 mt-auto mb-10">
            <div onclick="window.open('https://m.youtube.com')" class="flex flex-col items-center">
                <div class="w-16 h-16 bg-red-600 rounded-2xl flex items-center justify-center text-3xl shadow-xl">ðŸŽ¬</div>
                <span class="mt-2 text-[10px] font-bold">YouTube</span>
            </div>
            <div onclick="location.reload()" class="flex flex-col items-center text-zinc-500">
                <div class="w-16 h-16 bg-zinc-900 rounded-2xl flex items-center justify-center text-3xl border border-zinc-800">ðŸ”„</div>
                <span class="mt-2 text-[10px] font-bold">Reset</span>
            </div>
        </div>
    </div>

    <script type="module">
        import { GoogleGenerativeAI } from "@google/generative-ai";

        // 1. API ANAHTARINI KONTROL ET
        function checkApi() {
            const savedKey = localStorage.getItem('capy_api');
            if (!savedKey) {
                document.getElementById('api-setup').style.display = 'flex';
                return null;
            }
            return savedKey;
        }

        window.saveApiKey = () => {
            const key = document.getElementById('api-input').value;
            if (key.length < 10) { alert("Kanka o ne Ã¶yle, gerÃ§ek anahtarÄ± yaz!"); return; }
            localStorage.setItem('capy_api', key);
            location.reload();
        };

        const currentKey = checkApi();
        
        if (currentKey) {
            const genAI = new GoogleGenerativeAI(currentKey);

            window.askCapy = async () => {
                const q = prompt("Gemini'ye dÃ¶kÃ¼l kanka:");
                if(!q) return;

                const st = document.getElementById('ai-status');
                st.innerText = "Gemini'ye sinyal Ã§akÄ±yorum...";

                try {
                    const model = genAI.getGenerativeModel({ model: "gemini-1.5-flash" });
                    const result = await model.generateContent(`Sen bir Sigma Capybara'sÄ±n. Kanka tarzÄ±nda cevap ver: ${q}`);
                    const response = await result.response;
                    const text = response.text();

                    st.innerText = text;
                    const s = new SpeechSynthesisUtterance(text);
                    s.lang = 'tr-TR'; s.pitch = 0.5; window.speechSynthesis.speak(s);
                } catch (err) {
                    st.innerText = "Kanka API'de sÄ±kÄ±ntÄ± var. Ya anahtar yanlÄ±ÅŸ ya da yetkisi yok. Sol Ã¼stten sÄ±fÄ±rla!";
                }
            };
            document.getElementById('capy-btn').onclick = window.askCapy;
        }

        // Saat
        setInterval(() => {
            let d = new Date();
            document.getElementById('top-clock').innerText = d.getHours() + ":" + d.getMinutes().toString().padStart(2, '0');
        }, 1000);
    </script>
</body>
</html>
