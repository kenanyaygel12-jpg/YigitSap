<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yigitsap | P2P Chat</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        body { font-family: sans-serif; background: #e5ddd5; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        #app { width: 100%; max-width: 400px; background: white; border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); display: flex; flex-direction: column; height: 90vh; }
        #header { background: #075e54; color: white; padding: 15px; border-radius: 10px 10px 0 0; font-weight: bold; }
        #chat-box { flex: 1; padding: 15px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; }
        .msg { padding: 8px 12px; border-radius: 8px; max-width: 80%; word-wrap: break-word; }
        .sent { background: #dcf8c6; align-self: flex-end; }
        .received { background: #fff; align-self: flex-flex-start; border: 1px solid #ddd; }
        #controls { padding: 10px; border-top: 1px solid #ddd; display: flex; flex-direction: column; gap: 5px; }
        input { padding: 10px; border: 1px solid #ccc; border-radius: 5px; }
        button { padding: 10px; background: #25d366; border: none; color: white; border-radius: 5px; cursor: pointer; font-weight: bold; }
        #my-id-display { font-size: 12px; color: #333; margin-bottom: 5px; }
    </style>
</head>
<body>

<div id="app">
    <div id="header">Yigitsap P2P</div>
    
    <div id="chat-box" id="messages">
        <div class="msg received">Sistem: Yigitsap'a hoş geldin! Kimliğini oluştur ve arkadaşına gönder.</div>
    </div>

    <div id="controls">
        <div id="my-id-display">ID'niz oluşturuluyor...</div>
        <input type="text" id="target-id" placeholder="Arkadaşının ID'sini yapıştır">
        <button onclick="baglan()">Arkadaşına Bağlan</button>
        <hr style="width:100%">
        <input type="text" id="message-input" placeholder="Mesaj yaz...">
        <button onclick="mesajGonder()">Gönder</button>
    </div>
</div>

<script>
    let peer;
    let conn;
    const chatBox = document.getElementById('chat-box');
    const myIdDisplay = document.getElementById('my-id-display');

    // 1. Peer oluşturma (Kayıt olma gibi düşün)
    peer = new Peer(); 

    peer.on('open', (id) => {
        myIdDisplay.innerText = "Senin ID'n: " + id;
        console.log('ID alındı: ' + id);
    });

    // 2. Gelen bağlantıları kabul et
    peer.on('connection', (c) => {
        conn = c;
        setupChat();
    });

    // 3. Birine bağlanma fonksiyonu
    function baglan() {
        const targetId = document.getElementById('target-id').value;
        conn = peer.connect(targetId);
        setupChat();
    }

    function setupChat() {
        conn.on('data', (data) => {
            ekranaYaz(data, 'received');
        });
        ekranaYaz("Bağlantı kuruldu!", "received");
    }

    // 4. Mesaj Gönderme
    function mesajGonder() {
        const msg = document.getElementById('message-input').value;
        if (conn && conn.open) {
            conn.send(msg);
            ekranaYaz(msg, 'sent');
            document.getElementById('message-input').value = "";
        } else {
            alert("Önce birine bağlanmalısın!");
        }
    }

    function ekranaYaz(text, type) {
        const div = document.createElement('div');
        div.classList.add('msg', type);
        div.innerText = text;
        chatBox.appendChild(div);
        chatBox.scrollTop = chatBox.scrollHeight;
    }
</script>

</body>
</html>
