<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yigitsap | Online</title>
    <script src="https://cdn.ably.com/lib/ably.min-1.js"></script>
    <style>
        body { font-family: sans-serif; background: #0b141a; color: white; margin: 0; display: flex; justify-content: center; align-items: center; height: 100vh; }
        #app { width: 90%; max-width: 400px; height: 80vh; background: #111b21; border-radius: 10px; display: flex; flex-direction: column; border: 1px solid #2a3942; }
        #header { background: #202c33; padding: 15px; text-align: center; color: #00a884; font-weight: bold; }
        #messages { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 10px; }
        .msg { padding: 10px; border-radius: 8px; font-size: 14px; max-width: 80%; }
        .sent { background: #005c4b; align-self: flex-end; }
        .received { background: #202c33; align-self: flex-start; }
        .input-area { padding: 10px; background: #202c33; display: flex; gap: 5px; }
        input { flex: 1; padding: 10px; border: none; border-radius: 5px; background: #2a3942; color: white; }
        button { padding: 10px; background: #00a884; border: none; color: white; border-radius: 5px; cursor: pointer; }
        #setup { position: absolute; background: #111b21; width: 100%; height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 100; gap: 10px; }
    </style>
</head>
<body>

<div id="app">
    <div id="setup">
        <h2>Yigitsap</h2>
        <input type="text" id="u-name" placeholder="Adın">
        <input type="text" id="r-name" placeholder="Oda Adı">
        <button onclick="baglan()">Odaya Gir</button>
    </div>

    <div id="header">Oda: <span id="room-title">-</span></div>
    <div id="messages"></div>
    <div id="input-area" class="input-area">
        <input type="text" id="m-input" placeholder="Mesaj yaz...">
        <button onclick="gonder()">Gonder</button>
    </div>
</div>

<script>
    let ably, channel, username;

    function baglan() {
        username = document.getElementById('u-name').value;
        const room = document.getElementById('r-name').value;
        
        if(!username || !room) return alert("Boş bırakma kanka!");

        // Yeni API Key (Eğer çalışmazsa Ably'den ücretsiz bir tane alabilirsin)
        ably = new Ably.Realtime('8_Z7_w.67S86g:S7W_oH5E_G0h3_G0'); 
        
        ably.connection.on('connected', () => {
            console.log("Sunucuya bağlandık!");
            document.getElementById('setup').style.display = 'none';
            document.getElementById('room-title').innerText = room;
            
            channel = ably.channels.get(room);
            
            channel.subscribe('m', (msg) => {
                ekranaYaz(msg.data.u, msg.data.t);
            });
        });

        ably.connection.on('failed', () => alert("Bağlantı hatası! İnterneti kontrol et."));
    }

    function gonder() {
        const txt = document.getElementById('m-input').value;
        if(txt && channel) {
            channel.publish('m', { u: username, t: txt });
            document.getElementById('m-input').value = '';
        }
    }

    function ekranaYaz(u, t) {
        const div = document.createElement('div');
        div.className = 'msg ' + (u === username ? 'sent' : 'received');
        div.innerHTML = `<b>${u}:</b><br>${t}`;
        document.getElementById('messages').appendChild(div);
        document.getElementById('messages').scrollTop = document.getElementById('messages').scrollHeight;
    }
</script>

</body>
</html>
